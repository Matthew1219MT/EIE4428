<!doctype html>
<html>
<style>
    table, th, td {
        border: 1px solid black;
    }

    .center {
        text-align: center;
    }

    table.video {
        width : 80%; 
        height : 45%;
        margin-left:auto;
        margin-right:auto;
        border: 1px solid black;
    }

    td.btn {
        text-align: center;
        vertical-align: center;
    }

    .input {
        font-size:24pt;
    }

    button.function {
        width: 100%;
        height: 100px;
    }
</style>
<head>
    <title>EIE4428 MiniProject Remote Video Monitoring</title>
</head>
<body>
    <table style="background-color:#000000; width:100%;">
        <tr>
            <td><h2><p style="color:white;">EIE4428 MiniProject Remote Video Monitoring</p></h2>
            <h3><p style="color:white;">Tse Chun Hei    Sung Siu Fung</p></h3>
            </td>
        </tr>
        <tr>
        </tr>
    </table>
    <table style = "width:100%;">
        <tr style = "height:25%;">
            <td rowspan="4" style = "width:80%" class="center"><video id="video-preview" width="100%" height="100%" autoplay controls loop></video></td>
            <td class="center"><input type="text" id="broadcast-id" value="Enter Room ID" autocorrect=off autocapitalize=off class = "input"></td>
        </tr>
        <tr style = "height:25%;">
            <td class="center"><button id="open-or-join" class="function" style="font-size: 24px;">Auto Open / Join Broadcast</button></td>
        </tr>
        <tr style = "height:25%;">
            <td class="center"><button id="startRecord" class="function" style="font-size: 24px;" disabled>Start Recording</button></td>
        </tr>
        <tr style = "height:25%;">
            <td class="center"><button id="stopRecord" class="function" style="font-size: 24px;" disabled>Stop Recording</button></td>
        </tr>
    </table>
    <script src="https://muazkhan.com:9001/dist/RTCMultiConnection.min.js"></script>
    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <script src="https://muazkhan.com:9001/socket.io/socket.io.js"></script>
    <script src="https://www.webrtc-experiment.com/RecordRTC.js"></script>
    <script src="RecordRTC.js"></script>
    <script>
        const parts = [];
        let mediaRecorder;
        var Stream = document.getElementById("video-preview");

        document.getElementById("startRecord").onclick = function () {
            document.getElementById("startRecord").disabled = true;
            document.getElementById("stopRecord").disabled = false;
            mediaRecorder = new MediaRecorder(Stream.captureStream(25))
            mediaRecorder.start(1000);
            mediaRecorder.ondataavailable = function (e) {
                parts.push(e.data);
            }
        }

        document.getElementById("stopRecord").onclick = function () {
            document.getElementById("startRecord").disabled = false;
            document.getElementById("stopRecord").disabled = true;
            mediaRecorder.stop();
            const blob = new Blob(parts, {
                type: "video./mp4"
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            document.body.appendChild(a);
            a.style = "display: none";
            a.href = url;
            a.download = "test.mp4";
            a.click();
        }
    </script>
</body>
</html>	
