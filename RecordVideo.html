<html>
<style>
    .center {
        text-align: center;
    }

    table.video {
        width : 80%; 
        height : 45%;
        margin-left:auto;
        margin-right:auto;
        border: 1px solid black;
    }

    td {
        text-align: center;
        vertical-align: center;
    }
</style>
<head>
    <title>
        Camera Test
    </title>
</head>
<body>
    <h1 class = "center">Camera Test</h1>
    <table class="video">
        <tr>
            <td>
                <video id="video" width="100%" height="100%" autoplay></video>
            </td>
        </tr>
    </table>
    <table style = "margin-left:auto; margin-right:auto;">
        <tr>
            <td style = "width:20%;"><button id="showVideo">Open camera</button></td>
            <td style = "width:20%;"><button id="hideVideo" disabled>Close camera</button></td>
            <td style = "width:20%;"><button id="startButton" disabled>Start Recording</button></td>
            <td style = "width:20%;"><button id="stopButton" disabled>Stop Recording</div></td>
            <td style = "width:20%;"><a id="downloadButton" class="button">Download</a></td>
        </tr>
        <tr>
            <td colspan ="4"><p id = "log"></p></td>
        </tr>
    </table>
    <br><br>
</body>
<script>
    const parts = [];
    let mediaRecorder;
    var Stream;

    document.getElementById("showVideo").onclick = function () {
        navigator.mediaDevices.getUserMedia({ audio: false, video: true}).then(stream => {
            Stream = stream
            document.getElementById("video").srcObject = Stream;
            document.getElementById("showVideo").disabled = true;
            document.getElementById("hideVideo").disabled = false;
            document.getElementById("startButton").disabled = false;
        });
    }

    document.getElementById("hideVideo").onclick = function () {
        document.getElementById("video").srcObject = null;
        document.getElementById("showVideo").disabled = false;
        document.getElementById("hideVideo").disabled = true;
        document.getElementById("startButton").disabled = true;
        document.getElementById("stopButton").disabled = true;
    }

    document.getElementById("startButton").onclick = function () {
        document.getElementById("startButton").disabled = true;
        document.getElementById("stopButton").disabled = false;
        mediaRecorder = new MediaRecorder(Stream)
        mediaRecorder.start(1000);
        mediaRecorder.ondataavailable = function (e) {
            parts.push(e.data);
        }
    }

    document.getElementById("stopButton").onclick = function () {
        document.getElementById("startButton").disabled = false;
        document.getElementById("stopButton").disabled = true;
        mediaRecorder.stop();
        const blob = new Blob(parts, {
            type: "video./webm"
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        document.body.appendChild(a);
        a.style = "display: none";
        a.href = url;
        a.download = "test.webm";
        a.click();
    }
</script>
</html>